<div
  id="reading"
  class={[
    "w-full md:w-1/3 lg:w-80 xl:w-96 border-r bg-white min-h-screen md:overflow-auto md:block md:h-screen",
    @active_bookmark != nil and "hidden"
  ]}
  phx-hook="Open"
>
  <.sticky_header
    class="px-4 bg-white/90 backdrop-blur transition-shadow open:shadow-md"
    phx-click={JS.dispatch("js:scrolltop", to: "#reading")}
  >
    <.show_sidebar_button class="mr-3 xl:hidden" />
    <h1 class="grow font-semibold capitalize leading-0 text-zinc-800">
      <%= @active_tab %>
    </h1>
    <.icon_button id="add-bookmark-button" label="Add link" patch={~p"/reading/new"}>
      <Heroicons.plus class="h-5 w-5" stroke-width="2" />
    </.icon_button>
  </.sticky_header>

  <.bookmark_list
    :let={bookmark}
    id="reading-items"
    items={@bookmarks}
    phx_update={@phx_update}
    item_hidden={fn b -> deleted?(b) || b.folder != :reading end}
    item_click={&JS.patch(~p"/reading/#{&1}")}
    class="px-1"
  >
    <.link
      patch={~p"/reading/#{bookmark}"}
      class="relative w-fit max-w-full font-medium line-clamp-3 hover:text-primary-700"
    >
      <%= bookmark.title %>
    </.link>

    <a
      href={bookmark.url}
      target="_blank"
      rel="noopener noreferrer"
      class="relative w-fit max-w-full line-clamp-1 text-gray-500 hover:text-primary-700"
    >
      <%= get_domain(bookmark.url) %>
    </a>

    <div class="relative w-fit">
      <time class="text-sm text-gray-600"><%= format_time(bookmark.inserted_at) %></time>
      <.link
        phx-click="archive-bookmark"
        phx-value-id={bookmark.id}
        class="text-sm text-gray-400 hover:text-gray-900"
      >
        archive
      </.link>
    </div>
  </.bookmark_list>

  <div id="infinite-scroll-marker-body" phx-hook="InfiniteScroll"></div>
  <div id="infinite-scroll-marker-area" phx-hook="InfiniteScroll" data-scroll-area="reading">
  </div>

  <p :if={@bookmarks == []} class="mt-24 text-center text-sm text-gray-600">
    No articles saved.
  </p>
</div>

<div
  :if={@active_bookmark != nil}
  id="reading-detail"
  class="flex-1 min-w-0 bg-white min-h-screen md:overflow-auto md:block md:h-screen"
  phx-hook="Open"
>
  <.sticky_header
    class="px-4 bg-white/90 backdrop-blur transition-shadow open:shadow-md"
    phx-click={JS.dispatch("js:scrolltop", to: "#reading-detail")}
  >
    <.icon_button patch={~p"/reading"} class="md:hidden" label="Go back">
      <Heroicons.arrow_left class="h-5 w-5" stroke-width="2" />
    </.icon_button>
    <h1 class="grow font-semibold capitalize leading-0 text-zinc-800 line-clamp-1 opacity-0 transition-all translate-y-2 open:opacity-100 open:translate-y-0">
      <%= @active_bookmark.title %>
    </h1>
  </.sticky_header>
  <div class="px-4">
    <a
      href={@active_bookmark.url}
      target="_blank"
      rel="noopener noreferrer"
      class="block mb-3 font-bold text-2xl xl:text-3xl"
    >
      <%= @active_bookmark.title %>
    </a>

    <a href={@active_bookmark.url} target="_blank" rel="noopener noreferrer" class="text-gray-600">
      <%= get_domain(@active_bookmark.url) %>
    </a>

    <div
      :if={article = get_article(@active_bookmark)}
      class="mt-8 prose prose-zinc prose-sm sm:prose-base"
    >
      <%= raw(article.article_html || article.article_text) %>
    </div>
  </div>
</div>

<.modal
  :if={@live_action == :new}
  id="boomark-modal"
  show
  on_cancel={JS.patch(bookmark_path(@active_bookmark))}
>
  <.live_component
    id={:new}
    module={ReadmarkWeb.ReadingLive.FormComponent}
    bookmark={@bookmark}
    title={@page_title}
    action={@live_action}
    current_user={@current_user}
    return_to={bookmark_path(@active_bookmark)}
  />
</.modal>
